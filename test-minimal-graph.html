<!DOCTYPE html>
<html>
<head>
  <title>Minimal Graph Test</title>
  <script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
  <style>
    #cy { width: 100%; height: 95vh; border: 1px solid #ccc; }
  </style>
</head>
<body>
<div id="cy"></div>

<script>
console.log('=== MINIMAL GRAPH TEST ===');

// Test data similar to what the extension generates
const projectData = [
  {
    "name": "root",
    "type": "folder",
    "children": [
      {
        "name": "src",
        "type": "folder",
        "children": [
          {
            "name": "models.py",
            "type": "file",
            "children": []
          }
        ]
      }
    ]
  }
];

document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM loaded, initializing graph...');
  
  if (typeof cytoscape === 'undefined') {
    console.error('Cytoscape not loaded');
    document.getElementById('cy').innerHTML = '<div style="padding: 20px;">Cytoscape not loaded</div>';
    return;
  }
  
  console.log('Cytoscape available, creating graph...');
  
  const cy = cytoscape({
    container: document.getElementById('cy'),
    style: [
      { selector: 'node[type="folder"]', style: { shape:'rectangle','background-color':'yellow', label:'data(name)','text-valign':'center','text-halign':'center','font-weight':'bold','border-width':2,'border-color':'#000','width':150,'height':80 } },
      { selector: 'node[type="file"]', style: { shape:'rectangle','background-color':'skyblue', label:'data(name)','text-valign':'center','text-halign':'center','border-width':1,'border-color':'#000','width':120,'height':60 } }
    ],
    layout: { name:'preset' }
  });

  const expanded = {};

  // Add top-level folder nodes
  projectData.forEach((folder, i) => {
    const posX = 100 + (i % 3) * 300;
    const posY = 100 + Math.floor(i / 3) * 200;
    cy.add({ data: { id: folder.name, name: folder.name, type: 'folder' }, position: { x: posX, y: posY } });
  });

  // Recursive function to add children
  function addNode(parentId, nodeData, folderId, level=0, index=0){
    const id = parentId ? parentId + '_' + nodeData.name : nodeData.name;
    const posX = 150 + level*200;
    const posY = 100 + index*80;

    const dataObj = { id:id, name:nodeData.name, type:nodeData.type, folder:folderId };
    cy.add({ data: dataObj, position:{x:posX,y:posY} });

    if(parentId){
      cy.add({ data:{ id:'contains_' + id, source:parentId, target:id, type:'contains', folder:folderId } });
    }

    if(nodeData.children){
      nodeData.children.forEach((child,i)=>{
        addNode(id, child, folderId, level+1, i);
      });
    }
  }

  // Expand folder on click
  cy.on('tap', 'node[type="folder"]', function(evt){
    const folderId = evt.target.id();
    console.log('Folder clicked:', folderId);
    
    if(expanded[folderId]){
      cy.remove(cy.nodes().filter(n=>n.data('folder')===folderId));
      cy.remove(cy.edges().filter(e=>e.data('folder')===folderId));
      expanded[folderId] = false;
      console.log('Collapsed folder:', folderId);
      return;
    }

    const folderData = projectData.find(f=>f.name===folderId);
    if(folderData && folderData.children){
      console.log('Expanding folder:', folderId, 'children:', folderData.children.length);
      folderData.children.forEach((child,i)=>{
        addNode(folderId, child, folderId, 1, i);
      });
    }

    expanded[folderId] = true;
    cy.layout({ name:'cose', fit:false, nodeDimensionsIncludeLabels:true, animate:true, componentSpacing:100, nodeRepulsion:10000, edgeElasticity:100, nestingFactor:5, gravity:10, numIter:500 }).run();
  });
  
  console.log('âœ… Graph initialized successfully with', cy.nodes().length, 'nodes');
});
</script>
</body>
</html>